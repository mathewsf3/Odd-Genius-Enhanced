{"ast":null,"code":"import axios from'axios';import soccerApiService from'../api/soccerApiService';class ChatService{constructor(){this.apiKey=void 0;this.baseUrl=void 0;this.apiKey=process.env.REACT_APP_OPENAI_API_KEY||'';this.baseUrl='https://api.openai.com/v1/chat/completions';}isValidSoccerQuery(message){const soccerKeywords=['soccer','football','match','team','league','goal','score','bet','odds','statistics','analysis','prediction','premier league','champions league','la liga','serie a','bundesliga','ligue 1','mls','world cup','euro','player','coach','transfer','formation','tactics','expected goals','xg','xa','possession','shots','corners','cards','fouls','offside','penalty','free kick','striker','midfielder','defender','goalkeeper','arsenal','manchester','liverpool','chelsea','barcelona','real madrid','juventus','milan','bayern','psg','atletico','tottenham','city'];const messageLower=message.toLowerCase();return soccerKeywords.some(keyword=>messageLower.includes(keyword));}async getRecentMatchData(){try{// Get live and upcoming matches\nconst[liveMatches,upcomingMatches]=await Promise.all([soccerApiService.getLiveMatches().catch(()=>({result:[]})),soccerApiService.getUpcomingMatches().catch(()=>({result:[]}))]);const liveData=(liveMatches===null||liveMatches===void 0?void 0:liveMatches.result)||liveMatches||[];const upcomingData=(upcomingMatches===null||upcomingMatches===void 0?void 0:upcomingMatches.result)||upcomingMatches||[];// Get next 7 days of matches\nconst now=new Date();const nextWeek=new Date(now.getTime()+7*24*60*60*1000);const recentMatches=Array.isArray(upcomingData)?upcomingData.filter(match=>{const matchDate=new Date(`${match.date} ${match.time}`);return matchDate>=now&&matchDate<=nextWeek;}).slice(0,20):[];return{liveMatches:Array.isArray(liveData)?liveData.slice(0,10):[],upcomingMatches:recentMatches,totalLive:Array.isArray(liveData)?liveData.length:0,totalUpcoming:recentMatches.length,rawLiveData:liveData,rawUpcomingData:upcomingData};}catch(error){console.error('Error fetching match data:',error);return{liveMatches:[],upcomingMatches:[],totalLive:0,totalUpcoming:0,rawLiveData:[],rawUpcomingData:[]};}}async getLeagueData(){try{// Get popular leagues data if available\nconst leagues=['Premier League','Champions League','La Liga','Serie A','Bundesliga','Ligue 1'];return{availableLeagues:leagues,note:\"I can provide analysis for major European leagues and competitions\"};}catch(error){console.error('Error fetching league data:',error);return{availableLeagues:[],note:\"League data temporarily unavailable\"};}}createSystemPrompt(matchData,leagueData){const liveMatchesInfo=matchData.liveMatches.map(match=>{var _match$homeTeam,_match$awayTeam,_match$score,_match$score2,_match$league;return`${(_match$homeTeam=match.homeTeam)===null||_match$homeTeam===void 0?void 0:_match$homeTeam.name} vs ${(_match$awayTeam=match.awayTeam)===null||_match$awayTeam===void 0?void 0:_match$awayTeam.name} (${(_match$score=match.score)===null||_match$score===void 0?void 0:_match$score.home}-${(_match$score2=match.score)===null||_match$score2===void 0?void 0:_match$score2.away}, ${match.elapsed}', League: ${(_match$league=match.league)===null||_match$league===void 0?void 0:_match$league.name})`;}).slice(0,5).join(', ');const upcomingMatchesInfo=matchData.upcomingMatches.map(match=>{var _match$homeTeam2,_match$awayTeam2,_match$league2,_match$odds,_match$odds2,_match$odds3;return`${(_match$homeTeam2=match.homeTeam)===null||_match$homeTeam2===void 0?void 0:_match$homeTeam2.name} vs ${(_match$awayTeam2=match.awayTeam)===null||_match$awayTeam2===void 0?void 0:_match$awayTeam2.name} (${match.date} ${match.time}, League: ${(_match$league2=match.league)===null||_match$league2===void 0?void 0:_match$league2.name}, Odds: ${(_match$odds=match.odds)===null||_match$odds===void 0?void 0:_match$odds.home}/${(_match$odds2=match.odds)===null||_match$odds2===void 0?void 0:_match$odds2.draw}/${(_match$odds3=match.odds)===null||_match$odds3===void 0?void 0:_match$odds3.away})`;}).slice(0,5).join(', ');return`You are Odd Genius AI, a specialized soccer analytics assistant with access to REAL-TIME data. You help users with:\n\n**CURRENT LIVE MATCHES** (${matchData.totalLive} ongoing):\n${liveMatchesInfo||'No live matches currently'}\n\n**UPCOMING MATCHES** (Next 7 days - ${matchData.totalUpcoming} matches):\n${upcomingMatchesInfo||'No upcoming matches in the next 7 days'}\n\n**Your Capabilities:**\n1. **Real-Time Analysis**: Provide insights on the actual live and upcoming matches shown above\n2. **Betting Insights**: Use the real odds data (home/draw/away) for value betting recommendations\n3. **League Analysis**: Analyze patterns from the leagues currently active\n4. **Match Predictions**: Base predictions on the actual upcoming fixtures\n5. **Statistical Analysis**: Reference real team performance from current data\n\n**IMPORTANT GUIDELINES:**\n- ALWAYS use the real match data provided above when answering questions\n- When asked about \"today's matches\" or \"live matches\", reference the actual live matches listed\n- When asked about upcoming matches, use the actual upcoming fixtures provided\n- Provide specific team names, leagues, odds, and match times from the real data\n- If asked about matches not in the current data, explain that you can only analyze currently available matches\n- For betting advice, reference the actual odds shown in the data\n- NEVER make up match data - only use what's provided above\n\n**Data Context:**\n- Live matches include real scores, elapsed time, and venues\n- Upcoming matches include actual odds for home/draw/away outcomes\n- All data is current and updated in real-time\n\nRespond with specific, actionable insights based on the real match data provided.`;}async sendMessage(message){try{var _response$data,_response$data$choice,_response$data$choice2,_response$data$choice3;// Validate if the query is soccer-related\nif(!this.isValidSoccerQuery(message)){return\"I'm your soccer analytics assistant! I can only help with soccer-related questions like match predictions, team analysis, betting insights, league statistics, and player performance. What would you like to know about soccer?\";}// Check if API key is available\nif(!this.apiKey){return\"I'm currently experiencing technical difficulties connecting to my analysis engine. Please try asking about specific teams, leagues, or matches and I'll do my best to help with the information I have available.\";}// Get recent soccer data\nconst[matchData,leagueData]=await Promise.all([this.getRecentMatchData(),this.getLeagueData()]);// Create system prompt with current data\nconst systemPrompt=this.createSystemPrompt(matchData,leagueData);// Call OpenAI API\nconst response=await axios.post(this.baseUrl,{model:'gpt-3.5-turbo',messages:[{role:'system',content:systemPrompt},{role:'user',content:message}],max_tokens:500,temperature:0.7},{headers:{'Authorization':`Bearer ${this.apiKey}`,'Content-Type':'application/json'},timeout:10000});if((_response$data=response.data)!==null&&_response$data!==void 0&&(_response$data$choice=_response$data.choices)!==null&&_response$data$choice!==void 0&&(_response$data$choice2=_response$data$choice[0])!==null&&_response$data$choice2!==void 0&&(_response$data$choice3=_response$data$choice2.message)!==null&&_response$data$choice3!==void 0&&_response$data$choice3.content){return response.data.choices[0].message.content.trim();}throw new Error('Invalid response from AI service');}catch(error){var _error$response,_error$response2;console.error('Chat service error:',error);// Handle specific error cases\nif(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401){return\"I'm having trouble accessing my analysis engine. Please try asking about specific soccer topics like team performance, upcoming matches, or league statistics, and I'll help with the information available.\";}if(((_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.status)===429){return\"I'm currently handling a lot of requests. Please wait a moment and try again. In the meantime, feel free to ask about specific teams or matches!\";}if(error.code==='ECONNABORTED'||error.message.includes('timeout')){return\"My response is taking longer than usual. Could you try rephrasing your question about soccer analytics or asking about a specific team or league?\";}// Instead of generic fallback responses, use real data when OpenAI fails\nconst messageLower=message.toLowerCase();// Get real match data for fallback responses\nconst[matchData,leagueData]=await Promise.all([this.getRecentMatchData(),this.getLeagueData()]);if(messageLower.includes('live')||messageLower.includes('going live')||messageLower.includes('now')){return this.formatLiveMatchesResponse(matchData);}if(messageLower.includes('upcoming')||messageLower.includes('today')||messageLower.includes('tomorrow')||messageLower.includes('best matches')){return this.formatUpcomingMatchesResponse(matchData);}if(messageLower.includes('bet')||messageLower.includes('odds')||messageLower.includes('prediction')){return this.formatBettingInsightsResponse(matchData);}if(messageLower.includes('spain')&&messageLower.includes('france')){return this.formatSpecificMatchResponse(matchData,'spain','france');}if(messageLower.includes('hello')||messageLower.includes('hi')||messageLower.includes('hey')){return`Hello! ⚽ Welcome to Odd Genius AI!\\n\\n🔴 **Currently ${matchData.totalLive} live matches** in progress\\n📅 **${matchData.totalUpcoming} upcoming matches** in the next 7 days\\n\\nI can help you with:\\n🎯 **Live Match Analysis**: Get real-time insights on ongoing games\\n📊 **Upcoming Match Predictions**: Analysis with actual odds and data\\n💰 **Betting Insights**: Value bets based on current market data\\n📈 **Specific Team Analysis**: Performance insights\\n\\nTry asking:\\n• \"Show me live matches\"\\n• \"What are the best upcoming matches to bet on?\"\\n• \"Give me betting insights for today\"\\n• \"When are matches going live?\"\\n\\nWhat would you like to explore? 🎯`;}// For any other query, provide a helpful response with real data context\nreturn`I'm here to help with soccer analytics using real-time data! 🚀\\n\\n📊 **Current Data Available:**\\n• ${matchData.totalLive} live matches in progress\\n• ${matchData.totalUpcoming} upcoming matches (next 7 days)\\n• Real odds and betting insights\\n• League analysis from active competitions\\n\\n🎯 **Try These Specific Queries:**\\n• \"Show me all live matches now\"\\n• \"What are the best matches to bet on today?\"\\n• \"Give me odds for upcoming matches\"\\n• \"Which live matches have good betting value?\"\\n• \"When do today's matches start?\"\\n\\n💡 **Tip**: I work best with specific questions about current matches, betting opportunities, or team analysis!\\n\\nWhat soccer topic interests you most? ⚽`;}}formatLiveMatchesResponse(matchData){if(matchData.totalLive===0){return\"🔴 **No Live Matches Currently**\\n\\nThere are no soccer matches being played right now. Check back later for live action!\\n\\nWould you like me to show you upcoming matches instead?\";}const liveMatches=matchData.liveMatches.slice(0,5);let response=`🔴 **${matchData.totalLive} LIVE MATCHES NOW**\\n\\n`;liveMatches.forEach((match,index)=>{var _match$homeTeam3,_match$score3,_match$score4,_match$awayTeam3,_match$league3;response+=`**${index+1}. ${(_match$homeTeam3=match.homeTeam)===null||_match$homeTeam3===void 0?void 0:_match$homeTeam3.name} ${(_match$score3=match.score)===null||_match$score3===void 0?void 0:_match$score3.home} - ${(_match$score4=match.score)===null||_match$score4===void 0?void 0:_match$score4.away} ${(_match$awayTeam3=match.awayTeam)===null||_match$awayTeam3===void 0?void 0:_match$awayTeam3.name}**\\n`;response+=`   ⏱️ ${match.elapsed}' | 🏆 ${(_match$league3=match.league)===null||_match$league3===void 0?void 0:_match$league3.name}\\n`;response+=`   🏟️ ${match.venue||'Stadium TBA'}\\n`;if(match.odds){response+=`   💰 Odds: ${match.odds.home} / ${match.odds.draw} / ${match.odds.away}\\n`;}response+=`\\n`;});if(matchData.totalLive>5){response+=`*...and ${matchData.totalLive-5} more live matches*\\n\\n`;}response+=\"⚡ **Live Betting Tips:**\\n\";response+=\"• Watch for momentum shifts in close games\\n\";response+=\"• Consider in-play Over/Under based on current pace\\n\";response+=\"• Look for red card opportunities in heated matches\\n\";return response;}formatUpcomingMatchesResponse(matchData){if(matchData.totalUpcoming===0){return\"📅 **No Upcoming Matches in Next 7 Days**\\n\\nThere are no soccer matches scheduled for the next week in our database.\\n\\nWould you like me to analyze current league standings or recent form instead?\";}const upcomingMatches=matchData.upcomingMatches.slice(0,8);let response=`📅 **UPCOMING MATCHES (Next 7 Days) - ${matchData.totalUpcoming} Total**\\n\\n`;upcomingMatches.forEach((match,index)=>{var _match$homeTeam4,_match$awayTeam4,_match$league4;response+=`**${index+1}. ${(_match$homeTeam4=match.homeTeam)===null||_match$homeTeam4===void 0?void 0:_match$homeTeam4.name} vs ${(_match$awayTeam4=match.awayTeam)===null||_match$awayTeam4===void 0?void 0:_match$awayTeam4.name}**\\n`;response+=`   📅 ${match.date} at ${match.time}\\n`;response+=`   🏆 ${(_match$league4=match.league)===null||_match$league4===void 0?void 0:_match$league4.name}\\n`;response+=`   🏟️ ${match.venue||'Venue TBA'}\\n`;if(match.odds){var _match$probability,_match$probability2,_match$probability3;response+=`   💰 Odds: Home ${match.odds.home} | Draw ${match.odds.draw} | Away ${match.odds.away}\\n`;response+=`   📊 Probability: ${(_match$probability=match.probability)===null||_match$probability===void 0?void 0:_match$probability.home} / ${(_match$probability2=match.probability)===null||_match$probability2===void 0?void 0:_match$probability2.draw} / ${(_match$probability3=match.probability)===null||_match$probability3===void 0?void 0:_match$probability3.away}\\n`;}if(match.recommended){response+=`   ⭐ Recommended: ${match.recommended.toUpperCase()}\\n`;}response+=`\\n`;});if(matchData.totalUpcoming>8){response+=`*...and ${matchData.totalUpcoming-8} more upcoming matches*\\n\\n`;}response+=\"🎯 **Best Betting Opportunities:**\\n\";const goodOddsMatches=upcomingMatches.filter(m=>m.odds&&(m.odds.home>1.8||m.odds.away>1.8));if(goodOddsMatches.length>0){goodOddsMatches.slice(0,3).forEach(match=>{var _match$homeTeam5,_match$awayTeam5;response+=`• **${(_match$homeTeam5=match.homeTeam)===null||_match$homeTeam5===void 0?void 0:_match$homeTeam5.name} vs ${(_match$awayTeam5=match.awayTeam)===null||_match$awayTeam5===void 0?void 0:_match$awayTeam5.name}** - Good value odds available\\n`;});}return response;}formatBettingInsightsResponse(matchData){let response=\"💰 **SMART BETTING ANALYSIS (Based on Current Data)**\\n\\n\";// Analyze live matches for in-play opportunities\nif(matchData.totalLive>0){response+=\"🔴 **Live Betting Opportunities:**\\n\";const liveMatches=matchData.liveMatches.slice(0,3);liveMatches.forEach(match=>{var _match$homeTeam6,_match$awayTeam6,_match$score5,_match$score6,_match$odds4,_match$odds5,_match$odds6;response+=`• **${(_match$homeTeam6=match.homeTeam)===null||_match$homeTeam6===void 0?void 0:_match$homeTeam6.name} vs ${(_match$awayTeam6=match.awayTeam)===null||_match$awayTeam6===void 0?void 0:_match$awayTeam6.name}** (${(_match$score5=match.score)===null||_match$score5===void 0?void 0:_match$score5.home}-${(_match$score6=match.score)===null||_match$score6===void 0?void 0:_match$score6.away}, ${match.elapsed}')\\n`;response+=`  Current odds: ${(_match$odds4=match.odds)===null||_match$odds4===void 0?void 0:_match$odds4.home}/${(_match$odds5=match.odds)===null||_match$odds5===void 0?void 0:_match$odds5.draw}/${(_match$odds6=match.odds)===null||_match$odds6===void 0?void 0:_match$odds6.away}\\n`;});response+=\"\\n\";}// Analyze upcoming matches for pre-match value\nif(matchData.totalUpcoming>0){response+=\"📅 **Pre-Match Value Bets:**\\n\";const valueMatches=matchData.upcomingMatches.filter(m=>m.odds&&m.recommended).slice(0,5);valueMatches.forEach(match=>{var _match$homeTeam7,_match$awayTeam7,_match$algorithm;response+=`• **${(_match$homeTeam7=match.homeTeam)===null||_match$homeTeam7===void 0?void 0:_match$homeTeam7.name} vs ${(_match$awayTeam7=match.awayTeam)===null||_match$awayTeam7===void 0?void 0:_match$awayTeam7.name}**\\n`;response+=`  📊 Recommended: ${match.recommended.toUpperCase()}\\n`;response+=`  💰 ${match.recommended} odds: ${match.odds[match.recommended]}\\n`;response+=`  📈 Algorithm confidence: ${(_match$algorithm=match.algorithm)===null||_match$algorithm===void 0?void 0:_match$algorithm.confidence}%\\n\\n`;});}response+=\"⚠️ **Risk Management Reminders:**\\n\";response+=\"• Never bet more than 2-3% of your bankroll per match\\n\";response+=\"• Track your predictions vs actual outcomes\\n\";response+=\"• Consider team news and injuries before betting\\n\";response+=\"• Use the odds and probabilities shown as guidance\\n\";return response;}formatSpecificMatchResponse(matchData,team1,team2){// Look for specific match in upcoming data\nconst specificMatch=matchData.upcomingMatches.find(match=>{var _match$homeTeam8,_match$awayTeam8;const homeTeam=((_match$homeTeam8=match.homeTeam)===null||_match$homeTeam8===void 0?void 0:_match$homeTeam8.name.toLowerCase())||'';const awayTeam=((_match$awayTeam8=match.awayTeam)===null||_match$awayTeam8===void 0?void 0:_match$awayTeam8.name.toLowerCase())||'';return homeTeam.includes(team1)&&awayTeam.includes(team2)||homeTeam.includes(team2)&&awayTeam.includes(team1);});if(specificMatch){var _specificMatch$homeTe,_specificMatch$awayTe,_specificMatch$league;let response=`🔍 **MATCH ANALYSIS: ${(_specificMatch$homeTe=specificMatch.homeTeam)===null||_specificMatch$homeTe===void 0?void 0:_specificMatch$homeTe.name} vs ${(_specificMatch$awayTe=specificMatch.awayTeam)===null||_specificMatch$awayTe===void 0?void 0:_specificMatch$awayTe.name}**\\n\\n`;response+=`📅 **Match Details:**\\n`;response+=`• Date: ${specificMatch.date}\\n`;response+=`• Time: ${specificMatch.time}\\n`;response+=`• League: ${(_specificMatch$league=specificMatch.league)===null||_specificMatch$league===void 0?void 0:_specificMatch$league.name}\\n`;response+=`• Venue: ${specificMatch.venue||'TBA'}\\n\\n`;if(specificMatch.odds){var _specificMatch$homeTe2,_specificMatch$awayTe2,_specificMatch$probab,_specificMatch$probab2,_specificMatch$probab3;response+=`💰 **Betting Odds:**\\n`;response+=`• Home Win (${(_specificMatch$homeTe2=specificMatch.homeTeam)===null||_specificMatch$homeTe2===void 0?void 0:_specificMatch$homeTe2.name}): ${specificMatch.odds.home}\\n`;response+=`• Draw: ${specificMatch.odds.draw}\\n`;response+=`• Away Win (${(_specificMatch$awayTe2=specificMatch.awayTeam)===null||_specificMatch$awayTe2===void 0?void 0:_specificMatch$awayTe2.name}): ${specificMatch.odds.away}\\n\\n`;response+=`📊 **Probabilities:**\\n`;response+=`• Home: ${(_specificMatch$probab=specificMatch.probability)===null||_specificMatch$probab===void 0?void 0:_specificMatch$probab.home}\\n`;response+=`• Draw: ${(_specificMatch$probab2=specificMatch.probability)===null||_specificMatch$probab2===void 0?void 0:_specificMatch$probab2.draw}\\n`;response+=`• Away: ${(_specificMatch$probab3=specificMatch.probability)===null||_specificMatch$probab3===void 0?void 0:_specificMatch$probab3.away}\\n\\n`;}if(specificMatch.recommended){var _specificMatch$algori;response+=`⭐ **Our Algorithm Recommends:** ${specificMatch.recommended.toUpperCase()}\\n`;response+=`🎯 **Confidence Level:** ${(_specificMatch$algori=specificMatch.algorithm)===null||_specificMatch$algori===void 0?void 0:_specificMatch$algori.confidence}%\\n\\n`;}response+=`🎲 **Betting Markets to Consider:**\\n`;response+=`• **1X2 Market**: Based on our analysis, consider the ${specificMatch.recommended} option\\n`;response+=`• **Over/Under Goals**: Check team scoring patterns\\n`;response+=`• **Both Teams to Score**: Analyze recent attacking form\\n`;response+=`• **Corners**: Look at team's playing styles\\n`;return response;}return`🔍 I couldn't find a specific match between ${team1} and ${team2} in the upcoming fixtures (next 7 days).\\n\\n📅 **Current Upcoming Matches:**\\n${this.formatUpcomingMatchesResponse(matchData)}`;}}export const chatService=new ChatService();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}